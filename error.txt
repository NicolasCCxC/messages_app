$companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';

$payTransaction = \App\Models\Membership::with('payTransaction')->where('company_id', $companyId)->orderBy('created_at')->first();

if ($payTransaction) { echo "Success! Found membership from: " . $payTransaction->purchase_date; } else { echo "Query worked, but no memberships found."; }


$companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';

$payTransaction = \App\Models\Membership::with('payTransaction')->where('company_id', $companyId)->orderBy('purchase_date', 'asc)->first();

if ($payTransaction) { echo "Success! Found membership from: " . $payTransaction->purchase_date; } else { echo "Query worked, but no memberships found."; }


message error: 

> $companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';$payTransaction = \App\Models\Membership::with('payTransaction')->where('company_id', $companyId)->orderBy('created_at')->first();if ($payTransaction) { echo "Success! Found membership from: " . $payTransaction->purchase_date; } else { echo "Query worked, but no memberships found."; }

   Illuminate\Database\QueryException  SQLSTATE[42703]: Undefined column: 7 ERROR:  column "created_at" does not exist
LINE 1: ...om "memberships" where "company_id" = $1 order by "created_a...
                                                             ^ (Connection: pgsql, SQL: select * from "memberships" where "company_id" = 83e80ae5-affc-32b4-b11d-b4cab371c48b order by "created_at" asc limit 1).

> $companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';$payTransaction = \App\Models\Membership::with('payTransaction')->where('company_id', $companyId)->orderBy('purchase_date’, ‘asc’)->first();if ($payTransaction) { echo "Success! Found membership from: " . $payTransaction->purchase_date; } else { echo "Query worked, but no memberships found."; }

   PARSE ERROR  PHP Parse error: Syntax error, unexpected T_ENCAPSED_AND_WHITESPACE in vendor/psy/psysh/src/Exception/ParseErrorException.php on line 44.

> 




-----
$companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';

$payTransaction = \App\Models\Membership::with('payTransaction')->where('company_id', $companyId)->orderBy('purchase_date', 'desc')->first();

if ($payTransaction) { echo "Success! Found membership from: " . $payTransaction->purchase_date; } else { echo "Query worked, but no memberships found."; }


--------------
    /**
     * Get last transaction by company
     *
     * @param string $companyId
     * @return model::all();
     */
    public function getLastTransactionByCompany(string $companyId)
    {
        return $this->model::where('company_id', $companyId)
            ->orderBy('created_at')
            ->first();
    }


     $payTransaction = $this->payTransactionEloquent->getLastTransactionByCompany($request['company_id']);



     ------TEST------
     // 1. Instantiate the class
$persistence = new \App\Infrastructure\Persistence\MembershipEloquent();

// 2. Define the ID (use the one from your logs)
$companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';

// 3. Call the method and check results
$result = $persistence->getLastTransactionByCompany($companyId);

if ($result) {
    echo "Found! ID: " . $result->id . " | Date: " . $result->purchase_date;
} else {
    echo "Query executed successfully but no record was found.";
}


---- new error: 

➜  famiefi-api-security git:(calidad-viejo-7036) ✗ php artisan tinker
Psy Shell v0.12.14 (PHP 8.2.28 — cli) by Justin Hileman
New PHP manual is available (latest: 3.0.1). Update with `--update-manual`
> $persistence = new \App\Infrastructure\Persistence\MembershipEloquent();
$companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';
$result = $persistence->getLastTransactionByCompany($companyId);
if ($result) { echo "Found! ID: " . $result->id . " | Date: " . $result->purchase_date; } else { echo "Query executed successfully but no record was= App\Infrastructure\Persistence\MembershipEloquent {#6032}

> companyId = '83e80ae5-affc-32b4-b11d-b4cab371c48b';

   PARSE ERROR  PHP Parse error: Syntax error, unexpected '=' in vendor/psy/psysh/src/Exception/ParseErrorException.php on line 44.

> $result = $persistence->getLastTransactionByCompany($companyId);

   Error  Call to undefined method App\Infrastructure\Persistence\MembershipEloquent::getLastTransactionByCompany().

> if ($result) { echo "Found! ID: " . $result->id . " | Date: " . $result->purchase_date; } else { echo "Query executed successfully but no record was found.";}

   WARNING  Undefined variable $result in /Users/nicolassanchez--desarrolladorestandar/Desktop/diggipymes/famiefi-api-securityeval()'d code.

Query executed successfully but no record was found.⏎
# FamiEFI Back Base

**Php: 7.3^**

Requisites
- Docker
- Docker-compose

## Project configuration

First, clone the docker project [laravel-docker](https://github.com/ccxcus/laravel-docker) and follow the Readme.

## Project Structure
```
/api
├── app
|   ├── Helper (Only transversal functions)
|   ├── HTTP
|   |   ├── Controllers
|   |   |   └── ExampleController.php
|   ├── Infrastructure (Contain the logic business)
|   |   ├── Formulation ( Accounting formula )
|   |   |   └── ExampleForm.php
|   |   ├── Persistence (Connections to database - ORM)
|   |   |   └── ExampleEloquent.php
|   |   ├── Services (Connections to others micro-services)
|   |   |   └── ExampleService.php
|   ├── Models
|   |   └── Example.php
|   ├── Traits
|   |   └── ExampleTrait.php
|   └── Jobs
├── database
|   ├── factories
|   ├── migrations
|   ├── seeders
├── routes
|   └── web.php 
├── test
|   ├── Unit (Unit Model)
|   |   └── HasExampleTest.php
|   ├── Feature (Unit EndPoint)
|   |   └── ExampleControllerTest.php
```
## Json Structure
It's mandatory use the next structure to send responses
```
{
    message: String,
    statusCode: Integer,
    service: Enum,
    data: List<Entities>,
}
```
- The answers must respect the structure generated by the ORM (ER diagram).
- Any error message must be in message followed by its internal or external code.
- All dates must be delivered to the front in unix date format
- All book values must be delivered as Double.
- Every calculation or additional field must respect the same level of its parent object.
  EX: If the withholding tax is calculated for each invoice, the source field will be within the invoice that the calculation was applied to.
```
Entity: invoice:[{
            id:1,
            number:'00001',
            total:12800,
            details:{....},
        }]
```
```
Response: invoice:[{
            id:1,
            number:'00001',
            total:12800,
            details:{....},
            withholding:400
        }]
```


## Documentation
- [Lumen documentation](https://lumen.laravel.com/docs/8.x)
- [Laravel documentation](https://laravel.com/docs/8.x/)
- [CCxC Develop conventions](http://10.8.0.1:5000/oo/r/624552358218611760)

## Packages
- [flipbox/lumen-generator](https://github.com/flipboxstudio/lumen-generator)
- [fruitcake/laravel-cors](https://github.com/fruitcake/laravel-cors)
- [facade/ignition](https://github.com/facade/ignition)
- [fzaninotto/faker](https://github.com/fzaninotto/Faker)
- [laravel/telescope](https://github.com/laravel/telescope)
- [nesbot/carbon](https://packagist.org/packages/nesbot/carbon)

## Name Guide
- When you create a trait, you must add Trait to the end of the word `ExampleTrait.php`
- The nomenclature is defined by [PSR-4](https://www.php-fig.org/psr/psr-4/)

## Notes
- The project use prefix 'api **/auth/** {service}' like a **Guard** for access to the endpoints without token.

## Commands
app:update-module-one-memberships {--action= : Upsert, add or remove module 1 (Digitalization of physical stores) to last membership by all companies
- php artisan app:update-module-one-memberships --help
- php artisan app:update-module-one-memberships --action=add
- php artisan app:update-module-one-memberships --action=remove

app:update-history-invoice-memberships - Command used to update the invoice counter history
- php artisan app:update-history-invoice-memberships
